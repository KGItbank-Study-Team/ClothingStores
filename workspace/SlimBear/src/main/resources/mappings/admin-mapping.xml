<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
 <mapper namespace="com.slimbear.mapper.Admin">
 
 	<!-- 관리자(admin) -->
 	<select id="SELECT_ADMIN_BY_ID" resultType="admin">
 		SELECT * FROM admin WHERE id=#{id}
 	</select>
 	
 	
 	<!-- 상품 전체 보기 -->
 	<select id="SELECT_PRODUCT_TOTAL_LIST" resultType="productTotalListItem" >
 		SELECT p.* , count(po.order_uid) as toc, if(po.order_uid is not null, SUM(cnt), 0) as tpc 
		FROM product p LEFT JOIN 
		orderDetail po ON(p.uid=SUBSTRING_INDEX(po.prod_code,':',1))
		GROUP BY p.uid
 	</select>
 	
 	<select id="SELECT_ORDER_LIST" resultType="com.kgitbank.slimbear.admin.dto.OrderListDTO">
 		SELECT m.id AS owner_id, o.*, p.status AS pay_status, p.type AS pay_type
		FROM productOrder o LEFT JOIN orderPayment p 
		ON(o.uid=p.order_uid)
		LEFT JOIN member m
		ON(o.mem_uid=m.uid);
 	</select>
 
 	
 	<select id="SELECT_ORDER_PRODUCTDETAIL_LIST_BY_ORDER_UID" resultType="java.util.HashMap">
 	 	SELECT SUBSTRING_INDEX(op.prod_code,':',1) AS prod_uid, SUBSTRING_INDEX(SUBSTRING_INDEX(op.prod_code,':',2),':',-1) AS color, SUBSTRING_INDEX(SUBSTRING_INDEX(op.prod_code,':',3),':',-1) AS size 
		, op.cnt, op.review_uid, p.*
		FROM orderDetail op LEFT JOIN product p ON(SUBSTRING_INDEX(op.prod_code,':',1) = p.uid)
		WHERE order_uid=#{order_id};
 	</select>
 	
 </mapper>