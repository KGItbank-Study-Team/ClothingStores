<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.slimbear.mapper.Product">

	<!-- 제품(product) -->
	<select id="SELECT_PROD_BY_UID" resultType="product">
		SELECT * FROM product
		WHERE uid=#{uid}
	</select>

	<select id="SELECT_PROD_LIST" resultType="product">
		SELECT * FROM product
		LIMIT 8;
	</select>

	<select id="SELECT_PROD_BY_CATEGORY" resultType="product">
		SELECT * FROM
		product WHERE ctg_uid=#{ctg_uid}
		LIMIT #{pageSize} OFFSET #{offset}
	</select>

	<select id="SELECT_PROD_BY_CATEGORY_ORDER_BY_PRICE"
		parameterType="product" resultType="product">
		SELECT *
		FROM product
		WHERE
		ctg_uid=#{ctg_uid}
		ORDER BY price
		LIMIT #{pageSize}
		OFFSET #{offset}
	</select>

	<select id="SELECT_PROD_BY_CATEGORY_ORDER_BY_PRICE_DESC"
		resultType="product">
		SELECT * FROM product WHERE ctg_uid=#{ctg_uid} ORDER BY
		price DESC
		LIMIT #{pageSize} OFFSET #{offset};
	</select>


	<select id="SELECT_PROD_BY_CATEGORY_ORDER_BY_REG_DATE_DESC"
		resultType="product">
		SELECT * FROM product WHERE ctg_uid=#{ctg_uid} ORDER BY
		reg_date DESC
		LIMIT #{pageSize} OFFSET #{offset};
	</select>
	
	

	<select id="SELECT_BEST_PROD_BY_CATEGORY" resultType="product">
		SELECT
		p.*,
		od.cnt AS order_quantity
		FROM
		product p
		JOIN
		orderDetail od ON p.uid = od.prod_code
		ORDER BY
		od.cnt DESC
		LIMIT 8;
	</select>

	<select id="SELECT_COUNT_PROD_BY_UID" resultType="int">
		SELECT COUNT(*)
		FROM product WHERE ctg_uid=#{ctg_uid};
	</select>

	<insert id="INSERT_PRODUCT" useGeneratedKeys="true"
		keyProperty="uid">
		INSERT INTO
		`product` (`ctg_uid`, `name`, `desc`, `price`,
		`maker`, `main_image`,
		`reg_date`)
		VALUES(#{ctg_uid}, #{name}, #{desc},
		#{price}, #{maker}, #{main_image}, #{reg_date})
	</insert>

	<update id="UPDATE_PRODUCT" parameterType="product">
		UPDATE product
		SET ctg_uid=#{ctg_uid}, `name`=#{name}, `desc`=#{desc},
		price=#{price}
		<if test="main_image != null">
			,main_image=#{main_image}
		</if>
		WHERE uid=#{uid}
	</update>

	<!-- 제품상세(productDetail) -->
	<select id="getColorOptions" resultType="string"
		parameterType="long">
		SELECT DISTINCT color FROM productDetail WHERE prod_uid
		= #{productUID}
	</select>

	<select id="getSizeOptions" resultType="string"
		parameterType="long">
		SELECT DISTINCT size FROM productDetail WHERE prod_uid =
		#{productUID}
	</select>
	<!-- 제품상세검색 -->
	<select id="SELECT_PRODUCT_DETAIL" parameterType="productDetail"
		resultType="productDetail">
		SELECT *
		FROM productDetail
		WHERE
		prod_uid = #{prod_uid} AND
		color = #{color} AND
		size = #{size}
	</select>

	<!-- 제품상세검색리스트 -->
	<select id="SELECT_PRODUCT_DETAIL_LIST" parameterType="product"
		resultType="productDetail">
		SELECT *
		FROM productDetail
		WHERE
		prod_uid = #{prod_uid}
	</select>

	<!-- 제품상세등록 -->
	<insert id="INSERT_PRODUCT_DETAIL" parameterType="productDetail">
		INSERT INTO
		productDetail(prod_uid, color, size, cnt)
		VALUES (
		#{prod_uid},
		#{color},
		#{size},
		#{cnt}
		)
	</insert>

	<!-- 제품상세수정 -->
	<update id="UPDATE_PRODUCT_DETAIL" parameterType="productDetail">
		UPDATE
		productDetail
		SET
		cnt = #{cnt}
		WHERE
		prod_uid = #{prod_uid} AND
		color =
		#{color} AND
		size = #{size}
	</update>

	<!-- 제품상세삭제 -->
	<delete id="DELETE_PRODUCT_DETAIL" parameterType="productDetail">
		DELETE FROM
		productDetail
		WHERE
		prod_uid = #{prod_uid} AND
		color = #{color} AND
		size =
		#{size}
	</delete>
	
	<!-- 메인페이지 -->
	<select id="SELECT_PROD_ORDER_BY_REG_DATE_DESC"
		resultType="product">
		SELECT * FROM product ORDER BY
		reg_date DESC
		LIMIT #{pageSize} OFFSET #{offset};
	</select>
	
	<select id="SELECT_COUNT_PROD" resultType="int">
		SELECT COUNT(*)
		FROM product;
	</select>
	
	<select id="SELECT_BEST_PROD" resultType="product">
		SELECT
		p.*,
		od.cnt AS order_quantity
		FROM
		product p
		JOIN
		orderDetail od ON p.uid = od.prod_code
		ORDER BY
		od.cnt DESC
		LIMIT 8;
		
	</select>
	<select id="SELECT_NEW_PROD" resultType="product">
		SELECT *
		FROM product
		ORDER BY reg_date DESC
		LIMIT 10;
	</select>
	<select id="SELECT_PROD_ORDER_BY_PRICE"
		parameterType="product" resultType="product">
		SELECT *
		FROM product
		ORDER BY price
		LIMIT #{pageSize}
		OFFSET #{offset}
	</select>

	<select id="SELECT_PROD_ORDER_BY_PRICE_DESC"
		resultType="product">
		SELECT * FROM product ORDER BY
		price DESC
		LIMIT #{pageSize} OFFSET #{offset};
	</select>

</mapper>