<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="">

<title>기본 페이지 복사해서 써</title>

<!-- Custom fonts for this template -->
<link href="/admin/vendor/fontawesome-free/css/all.min.css"
	rel="stylesheet" type="text/css">
<link
	href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
	rel="stylesheet">

<!-- Custom styles for this template -->
<link href="/admin/css/sb-admin-2.css" rel="stylesheet">

<!-- Custom styles for this page -->
<link href="/admin/vendor/datatables/dataTables.bootstrap4.min.css"
	rel="stylesheet">

<!-- Bootstrap core JavaScript-->
<script src="/admin/vendor/jquery/jquery.min.js"></script>
<script src="/admin/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<!-- Core plugin JavaScript-->
<script src="/admin/vendor/jquery-easing/jquery.easing.min.js"></script>

<!-- Custom scripts for all pages-->
<script src="/admin/js/sb-admin-2.min.js"></script>

<link
	href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"
	rel="stylesheet">

<script
	src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script>
<script
	src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table-locale-all.min.js"></script>

<!-- Export -->
<script
	src="https://cdn.jsdelivr.net/npm/tableexport.jquery.plugin@1.10.21/tableExport.min.js"></script>
<script
	src="https://cdn.jsdelivr.net/npm/tableexport.jquery.plugin@1.10.21/libs/jsPDF/jspdf.min.js"></script>
<script
	src="https://cdn.jsdelivr.net/npm/tableexport.jquery.plugin@1.10.21/libs/jsPDF-AutoTable/jspdf.plugin.autotable.js"></script>
<script
	src="https://unpkg.com/bootstrap-table@1.22.1/dist/extensions/export/bootstrap-table-export.min.js"></script>

<!-- toolbar -->
<script
	src="https://unpkg.com/bootstrap-table@1.22.1/dist/extensions/toolbar/bootstrap-table-toolbar.min.js"></script>

</head>

<body id="page-top">

	<!-- Page Wrapper -->
	<div id="wrapper">

		<!-- Sidebar -->
		<th:block th:include="common/leftSlider.html" />

		<!-- Content Wrapper -->
		<div id="content-wrapper" class="d-flex flex-column">

			<!-- Main Content -->
			<div id="content">
				<div class="card shadow mb-4">
					<div class="card-header py-3">
						<h6 class="m-0 font-weight-bold text-primary">게시글관리 -> FAQ관리</h6>
					</div>
					<div id="customToolbar"
						style="padding-top: 20px; padding-left: 20px; padding-bottom: 20px;">
						<button class="btn btn-primary" onclick="showAddNoticeForm()">새
							공지사항 등록</button>
					</div>
					<div class="card-body">

						<div id="toolbar"></div>

						<table id="table" data-locale="ko-KR" data-search="true"
							data-advanced-search="true" data-id-table="advancedTable"
							data-detail-view="true" data-pagination="true"
							data-show-export="true" data-show-columns="true"
							data-show-columns-toggle-all="true"
							data-page-list="[10, 25, 50, 100, all]"
							data-url="/admin/faq/list">
							<thead>
								<tr>
									<th data-field="uid" data-sortable="true" data-width="1">UID</th>
									<th data-field="question" data-sortable="true" data-width="1">질문</th>
									<th data-field="answer" data-sortable="true">답변</th>

									<th data-field="type" data-sortable="true" data-width="1">타입?</th>

							



									<th data-field="select" data-checkbox="true"></th>
									<th data-field="actions" data-formatter="actionsFormatter"
										data-width="1" data-events="actionsEvents">숨김/삭제</th>
								</tr>
							</thead>

						</table>
					</div>
				</div>
			</div>
			<!-- End of Main Content -->
		</div>

		<!-- End of Content Wrapper -->
	</div>
	<!-- Footer -->
	<div>
		<footer class="sticky-footer bg-white">
			<div class="container my-auto">
				<div class="copyright text-center my-auto">
					<span>Copyright &copy; Your Website 2020</span>
				</div>
			</div>
		</footer>
	</div>
	<!-- End of Footer -->

	<!-- Scroll to Top Button-->
	<a class="scroll-to-top rounded" href="#page-top"> <i
		class="fas fa-angle-up"></i>
	</a>

	<!-- Logout Modal-->
	<div class="modal fade" id="logoutModal" tabindex="-1" role="dialog"
		aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
					<button class="close" type="button" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">×</span>
					</button>
				</div>
				<div class="modal-body">Select "Logout" below if you are ready
					to end your current session.</div>
				<div class="modal-footer">
					<button class="btn btn-secondary" type="button"
						data-dismiss="modal">Cancel</button>
					<a class="btn btn-primary" href="login.html">Logout</a>
				</div>
			</div>
		</div>
	</div>

	<!-- 리뷰 목록을 펼쳤을 때 표시되는 영역 -->
	<div id="detail-wrapper"></div>

	<script>
    var lastOpenedRow = null;

    $(function () {
        // 테이블 초기화
        $('#table').bootstrapTable({
            formatSearch: function () {
                return '모든 항목 검색'
            },
            exportDataType: 'all',
            exportTypes: ['json', 'xml', 'csv', 'pdf'],
            exportOptions: {
                fileName: function () {
                    var cd = new Date().toLocaleDateString().replace(/\./g, '').replace(/\s/g, '');
                    return 'OrderTable_' + cd;
                }
            }
        });

        // 리뷰 목록의 각 행을 클릭했을 때 실행되는 이벤트
        $('#table').on('expand-row.bs.table', function (e, index, row, $detail) {
            // 이전에 열린 답글 입력 창이 있다면 닫기
            if (lastOpenedRow != null && lastOpenedRow !== index) {
                $('#table').bootstrapTable('collapseRow', lastOpenedRow);
            }

            $detail.html('상세 정보 불러오는 중....');
            $.ajax({
                url: "/admin/faq/getComment?reviewUID=" + row['uid'],
                type: "GET",
                success: function (result) {
                    var html = [];
                    html.push('<tbody>');

                    if (result) {
                        var comment = result;
                        html.push('<tr>');
                        html.push('<td>' + (result.status === 'SUCCESS' ? '답변완료' : '미등록') + '</td>');
                        html.push('</tr>');
                    }

                    html.push('</tbody></table></div>');

                    // 답글 작성 폼
                    html.push('<div class="reply-form">');
                    html.push('<form id="replyForm">');
                    html.push('<div class="mb-3">');
                    html.push('<label for="uid" class="form-label">UID</label>');
                    html.push('<input type="text" class="form-control dark-input" id="uid" value="' + row['uid'] + '" readonly>');
                    html.push('</div>');
                    html.push('<div class="mb-3">');
                    html.push('<label for="question" class="form-label">질문</label>');
                    html.push('<input type="text" class="form-control" id="question">');
                    html.push('</div>');
                    html.push('<div class="mb-3">');
                    html.push('<label for="answer" class="form-label">내용</label>');
                    html.push('<textarea class="form-control" id="answer" rows="3"></textarea>');
                    html.push('</div>');

                    html.push('<button type="button" class="btn btn-primary" style="margin-top: 10px;" onclick="addOrUpdateComment(' + row['uid'] + ')">faq수정</button>');
                    html.push('</form>');
                    html.push('</div>');

                    $detail.html(html);

                    // 답글이 있는 경우, 답글 내용을 폼에 채워줌
                    if (result) {
                        $('#question').val(result.question);
                        $('#answer').val(result.answer);
                    }

                    // 현재 열린 행을 저장
                    lastOpenedRow = index;

                    // 열린 행의 답글 작성 폼에서 '닫기' 버튼을 눌렀을 때의 이벤트 처리
                    $('#table').on('collapse-row.bs.table', function (e, index) {
                        if (lastOpenedRow === index) {
                            lastOpenedRow = null;
                        }
                    });
                },
                error: function () {
                    alert("error");
                }
            });
        });
    });

    // 리뷰 작성 일자를 포맷하는 함수
    function dateFormatter(value, row, index) {
        return [new Date(value).toLocaleDateString().replace(/\./g, '').replace(/\s/g, '-')].join('');
    }

    function ownerFormatter(value, row, index) {
        if (value == null)
            return ['-'].join('');
        else
            return ['<a class="btn btn-primary" href="/admin/home/member?memberID=', value, '">', value, '</a>'].join('')
    }

    function commentsFormatter(value, row, index) {
        if (value === 'SUCCESS') {
            return '<span class="badge badge-success">답변완료</span>';
        } else {
            return '<span class="badge badge-secondary">답변 미등록</span>';
        }
    }

    function actionsFormatter(value, row, index) {
        return [
            '<div class="btn-group" role="group">',
            '<button class="btn btn-dark btn-sm" onclick="hideRow(' + index + ')">Hide</button>',
            '<button class="btn btn-danger btn-sm" onclick="deleteRow(' + index + ')">Delete</button>',
            '</div>'
        ].join('');
    }

    function actionsEvents() {
        return {
            'click .btn-primary': function (e, value, row, index) {
                hideRow(index);
            },
            'click .btn-danger': function (e, value, row, index) {
                deleteRow(index);
            }
        };
    }

    function deleteRow(index) {
        var rowData = $('#table').bootstrapTable('getData')[index];

        // 확인을 위해 데이터 출력
        console.log('Data to be sent to the server:', rowData);
        console.log('Index of the row:', index);

        // 삭제 작업을 위한 확인 메시지 등을 표시하고 사용자가 확인하면 서버로 데이터 삭제 요청 전송
        if (confirm('삭제하시겠습니까?')) {
            $.ajax({
                url: '/admin/review/deleteData',
                method: 'DELETE',
                contentType: 'application/json',
                data: JSON.stringify(rowData),
                success: function (response) {
                    // 성공적으로 처리된 경우
                    alert('삭제가 완료되었습니다.');
                    // 테이블에서 해당 행을 제거하거나, 다시 불러와서 업데이트 등의 작업 수행
                },
                error: function (error) {
                    // 오류 발생 시
                    alert('삭제 중 오류가 발생했습니다.');
                }
            });
        }
    }
    
    $(document).ready(function () {
        // ...
        // 새 공지사항 등록 폼 표시
        function showAddNoticeForm() {
            var html = [];
            html.push('<div class="add-notice-form">');
            html.push('<div class="mb-3"><label for="addNoticeTitle" class="form-label">제목</label><input type="text" class="form-control" id="addNoticeTitle"></div>');
            html.push('<div class="mb-3"><label for="addNoticeContent" class="form-label">내용</label><textarea class="form-control" id="addNoticeContent" rows="3"></textarea></div>');
            html.push('<div class="mb-3"><label for="addNoticePriority" class="form-label">우선순위</label><input type="number" class="form-control" id="addNoticePriority"></div>');
            html.push('<div class="mb-3"><label for="addNoticeType" class="form-label">타입</label><input type="text" class="form-control" id="addNoticeType"></div>');
            html.push('<div class="mb-3"><label for="addNoticeMainImage" class="form-label">이미지 URL</label><input type="text" class="form-control" id="addNoticeMainImage"></div>');
            html.push('<button type="button" class="btn btn-primary" onclick="addNotice()">등록</button>');
            html.push('</div>');
            $('#addNoticeFormContainer').html(html.join(''));
        }

        // 새 공지사항 등록 버튼 클릭 시 실행되는 함수
        function addNotice() {
            var title = $('#addNoticeTitle').val();
            var content = $('#addNoticeContent').val();
            var priority = $('#addNoticePriority').val();
            var type = $('#addNoticeType').val();
            var mainImage = $('#addNoticeMainImage').val();

            // 데이터 유효성 검사 (필요에 따라 추가 검사 수행)
            if (!title.trim() || !content.trim() || !priority || !type.trim() || !mainImage.trim()) {
                alert('모든 필드를 입력하세요.');
                return;
            }

            // Ajax 요청
            $.ajax({
                url: "/admin/notice/addNotice",
                type: "POST",
                data: {
                    title: title,
                    content: content,
                    priority: priority,
                    type: type,
                    mainImage: mainImage
                },
                success: function (result) {
                    if (result.status === 'SUCCESS') {
                        alert('새 공지사항이 성공적으로 등록되었습니다.');
                    } else {
                        alert('새 공지사항 등록에 실패했습니다.');
                    }

                    // TODO: 성공 또는 실패에 따른 추가적인 동작 수행
                },
                error: function () {
                    alert("서버 오류로 인해 새 공지사항을 등록할 수 없습니다.");
                }
            });
        }
        // ...
    });

</script>

</html>